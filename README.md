# FPGA 기반 자동차 주행 시뮬레이터

본 프로젝트는 `Verilog HDL`을 사용하여 `HBE-Combo II-DLD` FPGA 보드 상에 실제 자동차의 주행 메커니즘과 계기판 시스템을 구현한 결과물입니다. 단순한 입출력 제어를 넘어 가속/감속 물리 엔진, 자동 변속 로직, 안전 시스템(ESS, 오토라이트) 등을 통합 설계하여 실시간 상호작용이 가능한 디지털 시스템을 구축하였습니다.

## 1. 개발 환경

* Target Board: `Hanback HBE-Combo II-DLD`
* Language: `Verilog HDL`
* Sensors & Actuators:
* Input: `Keypad (3x4)`, `DIP Switch`, `ADC (Potentiometer)`, `CDS Sensor`
* Output: `7-Segment`, `LCD`, `Full-color LED`, `Servo Motor`, `Step Motor`, `Piezo Buzzer`



## 2. 프로젝트 목표

* 자동차의 핵심 구동 메커니즘(가속, 감속, 변속)을 논리회로로 모델링
* 실시간 입력 데이터(페달, 센서)에 따른 차량 상태 연산 및 피드백 시스템 구현
* 가속/감속 물리 엔진 및 능동형 안전 편의 기능(ESS, 오토라이트) 통합

## 3. 주요 기능

### 가. 시스템 제어 및 상태 관리

* `FSM (Finite State Machine)` 기반의 상태 관리: `OFF` -> `ACC` -> `RUN` 3단계 제어
* `안전 시동 인터락 (Safety Interlock)`: 브레이크를 밟고 기어가 P단인 상태에서만 시동이 걸리도록 설계하여 급발진 방지 로직 구현

### 나. 주행 물리 엔진

* `아날로그 가속 제어`: `ADC`를 통해 가변 저항(가속 페달)의 깊이를 0~255 단계로 입력받아 정밀한 속도 제어
* `관성 주행 및 저항`: 가속 페달을 뗄 경우 마찰 계수와 공기 저항 시뮬레이션을 통해 속도가 자연스럽게 감소
* `자동 변속 시스템`: 현재 속도와 RPM을 분석하여 1단에서 6단까지 최적의 기어비로 자동 변속 (업/다운 시프트 히스테리시스 적용)

### 다. 안전 및 편의 기능

* `ESS (Emergency Stop Signal)`: 주행 중 급제동(Panic Brake) 감지 시 비상등이 자동으로 고속 점멸하여 후방 경고
* `오토 라이트 (Auto Light)`: `CDS 센서`가 조도를 감지하여 어두운 환경(터널, 야간) 진입 시 전조등 및 미등 자동 점등
* `후진 안전 기능`: 후진(R) 기어 진입 시 후방 경고 멜로디 출력 및 후진등 점등

### 라. 시각 및 청각적 피드백

* `디지털 계기판`: `7-Segment`를 통해 RPM 및 속도, 현재 기어 상태 실시간 표시 (OBD 모드 시 엔진 온도 표시)
* `아날로그 속도계`: `Servo Motor`를 PWM으로 제어하여 속도에 따라 바늘이 회전하는 아날로그 게이지 구현
* `사운드 제너레이터`: `Piezo Buzzer`를 이용해 현재 RPM에 비례하여 주파수가 변하는 가변 엔진 배기음 생성
* `조향 장치`: `Step Motor`를 사용하여 핸들의 좌/우 회전 및 조향감 표현

## 4. 조작 방법

### 입력 인터페이스

| 입력 장치 | 키(Key) | 기능(Function) |
| --- | --- | --- |
| Gear | `3` | P (주차) |
|  | `6` | R (후진) |
|  | `9` | N (중립) |
|  | `#` | D (주행) |
| Steering | `4` | 좌회전 |
|  | `5` | 우회전 |
|  | `2` | 핸들 원위치 |
| Brake | `7` | 급브레이크 (ESS 동작) |
|  | `*` | 일반 브레이크 |
| Etc | `1` | 경적 (Horn) |
|  | `0` | 시동 (Start/Stop) |
|  | `8` | 연료 강제 소모 |
| Pedal | `ADC 다이얼` | 가속 페달 (0~255) |

### 보조 기능 (DIP Switch)

| 스위치 | 기능 | 설명 |
| --- | --- | --- |
| `SW 1` | 좌측 방향지시등 | 좌측 깜빡이 동작 |
| `SW 2` | 우측 방향지시등 | 우측 깜빡이 동작 |
| `SW 3` | 비상등 | 양방향 깜빡이 동작 |
| `SW 4` | 하향등 | 전조등 켜기 |
| `SW 5` | 상향등 | 상향등 켜기 |
| `SW 6` | 저단 기어 모드 | 고출력 저단 주행 고정 |
| `SW 7` | 사이드 브레이크 | 주차 브레이크 체결 |
| `SW 8` | OBD 모드 | 계기판에 엔진 온도 표시 |

## 5. 구현 모듈 구조

전체 시스템은 `Top Module`을 중심으로 각 기능이 모듈화되어 있습니다.

* `Top Module`: 전체 시스템 입출력 및 모듈 간 연결 관리
* `Clock Generator`: 시스템 동작에 필요한 분주 클럭 생성 (0.05s, 1ms, 1s 등)
* `Vehicle Logic`: 가속, 감속, 변속, 연료, 온도 등 차량 내부 연산 처리
* `Display Unit`: 7-Segment 다이내믹 제어 및 RPM/속도 표시
* `LCD Module`: 주행 거리(ODO), 연료량, 시스템 메시지 출력
* `Light Controller`: 오토라이트 로직 및 브레이크/미등 밝기 제어 (PWM)
* `Sound Unit`: RPM 연동 엔진음, 경적, 후진 멜로디, 방향지시등 소리 합성
* `Motor Controller`: Servo(속도계) 및 Step(핸들) 모터 구동

## 6. 한계점 및 향후 개선 방향

본 프로젝트는 FPGA 보드의 하드웨어적 제약 사항으로 인해 다음과 같은 개선 가능성을 확인하였습니다.

### 제동 시스템의 아날로그화

현재 사용된 FPGA 보드는 사용 가능한 `ADC` 채널이 제한적이며, 브레이크 입력을 위한 별도의 압력 센서나 페달 인터페이스가 부재합니다. 불가피하게 디지털 스위치(Keypad)를 사용하여 제동 신호를 처리하였으나, 이는 실제 차량의 페달을 밟는 깊이에 따른 제동력 조절을 표현하는 데 물리적인 한계가 있습니다. 향후 멀티 채널 ADC를 통해 브레이크 페달의 압력 값을 0~255 단계로 입력받아 감속 가중치를 선형적으로 적용한다면 더욱 현실적인 주행감을 구현할 수 있습니다.

### 가속 페달 입력 장치의 물리적 개선

가속 입력을 위해 사용한 보드 내장 `가변 저항(Dial)`은 입력 값을 유지하는 데는 유리하지만, 실제 차량 페달과 같은 복원력이 없다는 점이 한계입니다. 실제 운전에서는 페달에서 발을 떼면 즉시 초기 위치(0)로 돌아가 감속(Engine Brake)이 시작되어야 하나, 다이얼 방식은 사용자가 직접 값을 0으로 돌려야 하는 조작의 불편함이 있습니다. 이를 탄성이 있는 슬라이드 센서나 스프링 형태의 입력 장치로 대체한다면 관성 주행과 감속 로직을 더욱 직관적으로 시뮬레이션 할 수 있습니다.

## 7. 팀원

* `문수호`: 메인 FSM 설계, 경고 모듈, 안전 로직 구현
* `이도헌`: 속도 연산 물리 엔진, 상태 표시 모듈, 디스플레이 제어 구현
